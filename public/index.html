<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src=https://observablehq.com/@d3/color-legend></script>
    <script type="module" src="../controllers/breweryController.js"></script>

    <title>US Map with State-wise Heatmap</title>
</head>
<body>
    <header>
        <h1>US Map with State-wise Heatmap</h1>

        <div id="dropdown-container">
            <label for="page-selection">Select Page:</label>
            <select id="page-selection" onchange="navigateToPage()">
                <option value="/">Home</option>
                <option value="/delete">Delete</option>
                <option value="/data">Add</option>
                <option value="/api/breweries">List of Data</option>
            </select>
        </div>

        <script>
            function navigateToPage() {
                const selectElement = document.getElementById('page-selection');
                const selectedValue = selectElement.value;
                window.location.href = selectedValue;
            }
        </script>
    </header>

    <main>
        <div id="map-container"></div>
    </main>

    <footer>
        <p>&copy; 2023 Your Brewery Website</p>
    </footer>

    <script type=module >
        import {Legend,transformStateToUSFIPS,processData} from "./dataprocess.js"
     
        const statesum = {};

        Promise.all([
            d3.json("10m.json"),
            fetch('/api/us').then(response => response.json())
        ]).then(([us, databaseData]) => {
            processData(databaseData,statesum);

        // generation of the map

            const width = 1200;
            const height = 800;

            const svg = d3.create("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", [0, 0, width, height])
                .style("max-width", "100%")
                .style("height", "auto");

            document.getElementById("map-container").appendChild(svg.node());

            let colorScale = d3.scaleSequential(d3.interpolateBlues);
            colorScale.domain([0, d3.max(Object.values(statesum))]);

            const path = d3.geoPath();

            svg.append("g")
                .attr("transform", "translate(610,20)")
                .append(() => Legend(colorScale, {title: "Number of breweries", width: 260}));
         
            svg.append("g")
                .selectAll("path")
                .data(topojson.feature(us, us.objects.states).features)
                .join("path")
                .attr("fill", d => colorScale(statesum[d.id] || 0))
                .attr("d", path);
            
        }).catch(error => console.error('Error fetching or processing data:', error));

        
    </script>
</body>
</html>
